<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script>
        // 动态设置base标签，根据环境自动选择路径
        (function() {
            var base = document.createElement('base');
            if (window.location.protocol === 'file:') {
                // 本地文件系统，使用相对路径
                base.href = './';
            } else {
                // 检测当前URL路径和主机名
                var pathname = window.location.pathname;
                var hostname = window.location.hostname;
                
                // 检测是否是Cloudflare部署（通过自定义域名）
                var isCloudflare = hostname !== 'liuzhifu1024.github.io' && 
                                   hostname !== 'localhost' && 
                                   hostname !== '127.0.0.1';
                
                // 如果路径包含 /lovetest1/，使用绝对路径
                if (pathname.indexOf('/lovetest1/') !== -1 || pathname.startsWith('/lovetest1')) {
                    // Cloudflare可能需要相对路径来避免SPA重写问题
                    if (isCloudflare) {
                        base.href = './';
                    } else {
                        base.href = '/lovetest1/';
                    }
                } else {
                    // 本地开发服务器或根目录部署，使用相对路径
                    base.href = './';
                }
            }
            document.head.insertBefore(base, document.head.firstChild);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基本信息填写 - 恋爱占有欲指数测试</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/info.css">
</head>
<body>
    <div class="info-page">
        <div class="container">
            <h1 class="page-title">基本信息填写</h1>
            <p class="page-subtitle">信息将帮助精准对比常模，仅本地存储</p>
            
            <form id="userInfoForm" class="info-form">
                <div class="form-group">
                    <label class="form-label">
                        年龄段 <span class="required">*</span>
                    </label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="ageRange" value="18-25" required>
                            <span>18-25岁</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ageRange" value="26-30" required>
                            <span>26-30岁</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ageRange" value="31-35" required>
                            <span>31-35岁</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ageRange" value="36-40" required>
                            <span>36-40岁</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ageRange" value="40+" required>
                            <span>40岁以上</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        性别 <span class="required">*</span>
                    </label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="gender" value="male" required>
                            <span>男</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="gender" value="female" required>
                            <span>女</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="gender" value="other" required>
                            <span>其他</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        恋爱状态 <span class="required">*</span>
                    </label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="relationshipStatus" value="dating" required>
                            <span>恋爱中</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipStatus" value="married" required>
                            <span>已婚</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipStatus" value="single" required>
                            <span>单身</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        恋爱持续时间
                    </label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="relationshipDuration" value="0-6">
                            <span>0-6个月</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipDuration" value="6-12">
                            <span>6-12个月</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipDuration" value="1-3">
                            <span>1-3年</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipDuration" value="3-5">
                            <span>3-5年</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="relationshipDuration" value="5+">
                            <span>5年以上</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">开始测试</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // 获取URL参数
        const urlParams = new URLSearchParams(window.location.search);
        const authCode = urlParams.get('authCode');
        const testType = urlParams.get('testType');
        
        if (!authCode || !testType) {
            window.location.href = 'index.html';
        }
        
        // 表单提交
        const form = document.getElementById('userInfoForm');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const formData = new FormData(form);
            const userInfo = {
                ageRange: formData.get('ageRange'),
                gender: formData.get('gender'),
                relationshipStatus: formData.get('relationshipStatus'),
                relationshipDuration: formData.get('relationshipDuration') || ''
            };
            
            // 验证必填字段
            if (!userInfo.ageRange || !userInfo.gender || !userInfo.relationshipStatus) {
                alert('请完善所有必填信息');
                return;
            }
            
            // 保存用户信息
            StorageManager.saveUserInfo(userInfo);
            
            // 跳转到答题页面
            window.location.href = `test.html?authCode=${authCode}&testType=${testType}`;
        });
        
        // 加载已保存的信息（如果有）
        const savedInfo = StorageManager.getUserInfo();
        if (savedInfo) {
            if (savedInfo.ageRange) {
                document.querySelector(`input[name="ageRange"][value="${savedInfo.ageRange}"]`).checked = true;
            }
            if (savedInfo.gender) {
                document.querySelector(`input[name="gender"][value="${savedInfo.gender}"]`).checked = true;
            }
            if (savedInfo.relationshipStatus) {
                document.querySelector(`input[name="relationshipStatus"][value="${savedInfo.relationshipStatus}"]`).checked = true;
            }
            if (savedInfo.relationshipDuration) {
                document.querySelector(`input[name="relationshipDuration"][value="${savedInfo.relationshipDuration}"]`).checked = true;
            }
        }
    </script>
</body>
</html>

