# 题库加载问题排查指南

## 已修复的问题

1. ✅ **添加了响应状态检查** - 现在会检查HTTP响应状态码
2. ✅ **添加了数据结构验证** - 验证JSON数据格式是否正确
3. ✅ **改进了错误提示** - 提供更详细的错误信息
4. ✅ **添加了file://协议检测** - 如果直接用浏览器打开HTML文件，会提示使用HTTP服务器

## 常见问题及解决方案

### 问题1: 使用file://协议打开HTML文件

**症状**: 控制台显示CORS错误，无法加载questionBank.json

**解决方案**:
```bash
# 在项目目录下运行HTTP服务器
python -m http.server 8000

# 然后访问
http://localhost:8000
```

### 问题2: GitHub Pages部署后无法加载

**可能原因**:
- 路径问题（如果仓库不是根目录）
- 文件未正确上传

**解决方案**:
1. 确认questionBank.json文件已上传到GitHub仓库
2. 如果仓库名不是用户名，需要在HTML中添加base标签:
   ```html
   <base href="/你的仓库名/">
   ```

### 问题3: 本地服务器运行时无法加载

**检查清单**:
1. ✅ 确认questionBank.json文件存在于项目根目录
2. ✅ 确认HTTP服务器正在运行（如: `python -m http.server 8000`）
3. ✅ 打开浏览器开发者工具（F12），查看Console标签页的错误信息
4. ✅ 查看Network标签页，确认questionBank.json请求是否成功（状态码应为200）

### 问题4: 题库数据格式错误

**验证方法**:
```bash
# 使用Python验证JSON格式
python -c "import json; f=open('questionBank.json','r',encoding='utf-8'); data=json.load(f); print('JSON有效'); print('自己测题目数:', len(data.get('selfTestQuestions',[]))); print('恋人测题目数:', len(data.get('loverTestQuestions',[])))"
```

**预期结果**:
- JSON有效
- 自己测题目数: 40
- 恋人测题目数: 40

## 调试步骤

1. **打开浏览器开发者工具** (F12)
2. **查看Console标签页** - 查看是否有错误信息
3. **查看Network标签页** - 查找questionBank.json请求:
   - 如果状态码是404: 文件不存在或路径错误
   - 如果状态码是200但仍有问题: 可能是JSON格式错误
   - 如果请求被阻止: 可能是CORS问题（需要HTTP服务器）

4. **检查本地存储**:
   ```javascript
   // 在浏览器控制台运行
   localStorage.getItem('questionBank')
   ```
   - 如果有数据，说明之前成功加载过
   - 可以尝试清除后重新加载

## 测试题库加载

在浏览器控制台运行以下代码测试题库加载：

```javascript
fetch('questionBank.json')
  .then(response => {
    console.log('响应状态:', response.status);
    if (!response.ok) {
      throw new Error(`HTTP错误! 状态: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log('题库加载成功!');
    console.log('自己测题目数:', data.selfTestQuestions?.length || 0);
    console.log('恋人测题目数:', data.loverTestQuestions?.length || 0);
  })
  .catch(error => {
    console.error('加载失败:', error);
  });
```

## 当前代码改进

### main.js 中的 loadQuestionBank 函数
- ✅ 检查HTTP响应状态
- ✅ 验证数据结构
- ✅ 提供详细的错误信息
- ✅ 检测file://协议并提示

### test.js 中的 loadQuestionBank 函数
- ✅ 检查HTTP响应状态
- ✅ 验证数据结构
- ✅ 验证题目数量
- ✅ 提供详细的错误信息
- ✅ 检测file://协议并提示

## 如果问题仍然存在

请提供以下信息：
1. 浏览器控制台的完整错误信息（Console和Network标签页）
2. 使用的访问方式（本地文件/本地服务器/GitHub Pages）
3. 浏览器版本和操作系统

